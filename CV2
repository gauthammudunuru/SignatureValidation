import cv2
import numpy as np
from PIL import Image

# Convert PIL image to OpenCV format
img = np.array(pages[0])
gray = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY)

# Threshold to binary
_, thresh = cv2.threshold(gray, 200, 255, cv2.THRESH_BINARY_INV)  # invert: signature = white

# Find contours
contours, _ = cv2.findContours(thresh, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)

# Filter small noise
signature_contours = [c for c in contours if cv2.contourArea(c) > 100]  # adjust threshold

# Draw bounding boxes on a copy
img_boxes = img.copy()
for i, c in enumerate(signature_contours):
    x, y, w, h = cv2.boundingRect(c)
    cv2.rectangle(img_boxes, (x, y), (x+w, y+h), (255, 0, 0), 2)
    
    # Crop and show
    cropped = pages[0].crop((x, y, x+w, y+h))
    show_image(cropped, f"Signature {i+1}")

# Show page with boxes
show_image(Image.fromarray(img_boxes), "Detected Signatures")
