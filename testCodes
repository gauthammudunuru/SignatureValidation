from pdf2image import convert_from_path

# Convert all pages to images
pages = convert_from_path("document.pdf", dpi=300)

# Optional: save images for inspection
for i, page in enumerate(pages):
    page.save(f"page_{i+1}.png")
from PIL import Image
import matplotlib.pyplot as plt

def show_image(img, title=""):
    plt.figure(figsize=(8, 10))
    plt.imshow(img)
    plt.axis("off")
    if title:
        plt.title(title)
    plt.show()

show_image(pages[0], "Page 1 Original")
import base64
from openai import OpenAI
import json

client = OpenAI()

def encode_image(img: Image.Image):
    import io
    buffered = io.BytesIO()
    img.save(buffered, format="PNG")
    return base64.b64encode(buffered.getvalue()).decode()

page_image = pages[0]
image_base64 = encode_image(page_image)

response = client.responses.create(
    model="gpt-4.1",
    input=[
        {
            "role": "user",
            "content": [
                {
                    "type": "input_text",
                    "text": """
Find handwritten signatures in this document page.

Return ONLY valid JSON:

{
  "signatures":[
    {"x":int,"y":int,"width":int,"height":int}
  ]
}
"""
                },
                {
                    "type": "input_image",
                    "image_url": f"data:image/png;base64,{image_base64}"
                }
            ]
        }
    ]
)

result_text = response.output_text
print("Raw AI Output:", result_text)
bbox_data = json.loads(result_text)
signatures = bbox_data["signatures"]
